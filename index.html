<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Mates & Prompt Powers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Baloo+2:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff;
            color: #1e3a8a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            overflow-x: hidden;
        }
        .app-container {
            background-color: #ffffff;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        .title-header {
            font-family: 'Baloo 2', cursive;
            color: #2563eb;
            font-size: 2.5rem;
            margin-bottom: 24px;
        }
        .character-area {
            margin-bottom: 24px;
            position: relative;
            height: 150px;
        }
        .character-image {
            width: 100px;
            height: 100px;
            background-color: #93c5fd;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 12px;
            font-size: 3rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .character-image.happy { transform: scale(1.1) rotate(5deg); }
        .character-image.thinking { transform: scale(1.05) rotate(-3deg); }
        .character-image.confused { animation: shake 0.5s; }
        .character-image.celebrate { animation: celebrate_anim 0.8s ease-in-out; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes celebrate_anim {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(-10deg); }
            50% { transform: scale(1.1) rotate(10deg); }
            75% { transform: scale(1.2) rotate(-5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .speech-bubble {
            background-color: #e0f2fe;
            color: #0c4a6e;
            padding: 12px 18px;
            border-radius: 16px;
            position: relative;
            display: inline-block;
            max-width: 90%;
            min-height: 40px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            font-size: 0.9rem;
        }
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #e0f2fe;
        }

        .problem-statement, .feedback-area {
            font-size: 1.25rem;
            margin-bottom: 20px;
            color: #172554;
            min-height: 30px;
        }
        .achievement-notification {
            background-color: #fef9c3; /* Light yellow */
            color: #713f12; /* Amber text */
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: none; /* Hidden by default */
            border: 1px solid #fde68a;
        }
        .input-field {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 2px solid #60a5fa;
            margin-bottom: 16px;
            font-size: 1rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-field:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            outline: none;
        }
        #userAnswerInput {
            display: none;
        }
        .submit-button {
            background-color: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
        }
        .submit-button:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .submit-button:active {
            transform: translateY(0);
        }
        .score-area {
            margin-top: 24px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .streak-counter {
            font-size: 0.9rem;
            color: #166534; /* Green for streak */
            font-weight: 600;
            margin-top: 8px;
            min-height: 20px; /* Ensure space even if empty */
        }
        .prompt-tips-button {
            background-color: #fbbf24;
            color: #78350f;
            padding: 10px 18px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s ease;
        }
        .prompt-tips-button:hover {
            background-color: #f59e0b;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 24px;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #1e3a8a;
        }
        .modal-content h3 {
            font-family: 'Baloo 2', cursive;
            color: #2563eb;
            margin-top: 0;
            font-size: 1.8rem;
        }
        .modal-content ul {
            list-style-type: '✨ ';
            padding-left: 20px;
        }
        .modal-content li {
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .close-button {
            background-color: #ef4444;
            color: white;
            padding: 10px 18px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            float: right;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #dc2626;
        }

        @media (max-width: 480px) {
            .title-header { font-size: 2rem; }
            .problem-statement, .feedback-area { font-size: 1.1rem; }
            .input-field { font-size: 0.9rem; }
            .submit-button { font-size: 1rem; padding: 10px 20px;}
            .character-image { width: 80px; height: 80px; font-size: 2.5rem; }
            .character-area { height: 130px; }
            .speech-bubble { padding: 10px 14px; font-size: 0.85rem; }
            .app-container { padding: 16px; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <h1 class="title-header">Math Mates & Prompt Powers</h1>

        <div class="character-area">
            <div id="character" class="character-image">🧠</div>
            <div class="speech-bubble" id="speechBubble">Hi! I'm Digit! Give me a times table problem to solve!</div>
        </div>

        <div id="achievementNotification" class="achievement-notification"></div>
        <div id="problemStatement" class="problem-statement"></div>
        <div id="feedbackArea" class="feedback-area"></div>

        <input type="text" id="promptInput" class="input-field" placeholder="e.g., Digit, solve 2 x 3">
        <input type="number" id="userAnswerInput" class="input-field" placeholder="Your answer...">
        <button id="submitButton" class="submit-button">Send Prompt!</button>

        <div id="scoreArea" class="score-area">Score: 0 | Level: 1</div>
        <div id="streakCounter" class="streak-counter"></div>
        <button id="promptTipsButton" class="prompt-tips-button">Show Prompt Tips ✨</button>
    </div>

    <div id="tipsModal" class="modal">
        <div class="modal-content">
            <span id="closeModalButton" class="close-button">&times; Close</span>
            <h3>🚀 Prompt Power Tips!</h3>
            <ul id="tipsList"></ul>
        </div>
    </div>

    <script>
        // DOM Elements
        const character = document.getElementById('character');
        const speechBubble = document.getElementById('speechBubble');
        const problemStatement = document.getElementById('problemStatement');
        const feedbackArea = document.getElementById('feedbackArea');
        const promptInput = document.getElementById('promptInput');
        const userAnswerInput = document.getElementById('userAnswerInput');
        const submitButton = document.getElementById('submitButton');
        const scoreArea = document.getElementById('scoreArea');
        const streakCounter = document.getElementById('streakCounter'); // New element for streaks
        const achievementNotification = document.getElementById('achievementNotification'); // New element for achievements
        const promptTipsButton = document.getElementById('promptTipsButton');
        const tipsModal = document.getElementById('tipsModal');
        const closeModalButton = document.getElementById('closeModalButton');
        const tipsList = document.getElementById('tipsList');

        // Game State
        let score = 0;
        let level = 1;
        let currentProblem = null;
        let gameStage = 'prompting';
        let currentMathStreak = 0; // For correct math answers
        let successfulPrompts = 0; // For prompt-based achievements
        let correctMathAnswers = 0; // For math-based achievements

        const characterEmojis = {
            idle: '🧠',
            thinking: '🤔',
            happy: '🥳',
            confused: '😕',
            correct: '�',
            celebrate: '🎉' // For level ups, big achievements
        };

        // Achievements
        const achievements = {
            PROMPT_ROOKIE: { id: 'PROMPT_ROOKIE', name: "🚀 Prompt Rookie!", condition: () => successfulPrompts >= 5, earned: false, desc: "5 successful prompts!" },
            PROMPT_EXPERT: { id: 'PROMPT_EXPERT', name: "✨ Prompt Expert!", condition: () => successfulPrompts >= 15, earned: false, desc: "15 successful prompts!" },
            MATH_BEGINNER: { id: 'MATH_BEGINNER', name: "➕ Math Beginner!", condition: () => correctMathAnswers >= 10, earned: false, desc: "10 correct math answers!" },
            SCORE_HERO_100: { id: 'SCORE_HERO_100', name: "💯 Score Hero: 100!", condition: () => score >= 100, earned: false, desc: "Reached 100 points!" },
            LEVEL_UP_STAR_2: { id: 'LEVEL_UP_STAR_2', name: "⭐ Level 2 Star!", condition: () => level >= 2, earned: false, desc: "Reached Level 2!" },
            TABLE_MASTER_2S: { id: 'TABLE_MASTER_2S', name: "🥈 Table Master: 2s!", targetTable: 2, count: 0, needed: 3, earned: false, desc: "Mastered three 2x problems!"},
            TABLE_MASTER_5S: { id: 'TABLE_MASTER_5S', name: "🏅 Table Master: 5s!", targetTable: 5, count: 0, needed: 3, earned: false, desc: "Mastered three 5x problems!"}
        };


        function updateScoreDisplay() {
            scoreArea.textContent = `Score: ${score} | Level: ${level}`;
        }

        function updateStreakDisplay() {
            if (currentMathStreak >= 2) {
                streakCounter.textContent = `🔥 ${currentMathStreak} in a row!`;
            } else {
                streakCounter.textContent = "";
            }
        }

        function notifyAchievement(achievement) {
            achievementNotification.textContent = `🏆 Achievement Unlocked: ${achievement.name} (${achievement.desc})`;
            achievementNotification.style.display = 'block';
            setTimeout(() => {
                achievementNotification.style.display = 'none';
            }, 4000); // Hide after 4 seconds
            setCharacterState('celebrate', `Wow! ${achievement.name}`);
        }

        function checkAchievements() {
            for (const key in achievements) {
                const ach = achievements[key];
                if (!ach.earned && ach.condition && ach.condition()) {
                    ach.earned = true;
                    notifyAchievement(ach);
                }
                // Specific handling for table master achievements
                if (!ach.earned && ach.targetTable && currentProblem &&
                    (currentProblem.num1 === ach.targetTable || currentProblem.num2 === ach.targetTable)) {
                    // This check should happen when an answer is correct
                }
            }
        }
        function checkTableMasterAchievements(isCorrect) {
            if (!isCorrect || !currentProblem) return;

            for (const key in achievements) {
                const ach = achievements[key];
                if (!ach.earned && ach.targetTable && (currentProblem.num1 === ach.targetTable || currentProblem.num2 === ach.targetTable)) {
                    ach.count = (ach.count || 0) + 1;
                    if (ach.count >= ach.needed) {
                        ach.earned = true;
                        notifyAchievement(ach);
                    }
                }
            }
        }


        const problemsByLevel = {
            1: [ { num1: 2, num2: 3 }, { num1: 5, num2: 2 }, { num1: 10, num2: 4 }, { num1: 1, num2: 7 }, { num1: 0, num2: 5 }, { num1: 2, num2: 8 }, { num1: 5, num2: 6 }, { num1: 10, num2: 7}],
            2: [ { num1: 3, num2: 4 }, { num1: 4, num2: 5 }, { num1: 6, num2: 3 }, { num1: 3, num2: 7 }, { num1: 4, num2: 6 }, { num1: 6, num2: 7 }, { num1: 3, num2: 9 }, { num1: 4, num2: 8 }],
            3: [ { num1: 7, num2: 3 }, { num1: 8, num2: 4 }, { num1: 9, num2: 2 }, { num1: 7, num2: 6, story: "7 dragons have 6 gems each." }, { num1: 8, num2: 7, story: "8 knights guard 7 towers each." }, { num1: 9, num2: 5, story: "9 wizards brew 5 potions." }, { num1: 7, num2: 9 }, { num1: 8, num2: 6 }, { num1: 9, num2: 8 }],
            4: [ { num1: 11, num2: 2 }, { num1: 12, num2: 3 }, { num1: 11, num2: 5 }, { num1: 12, num2: 4, story: "12 astronauts see 4 stars each." }, { num1: 11, num2: 7 }, { num1: 12, num2: 6 }, { num1: 6, num2: 11 }, { num1: 8, num2: 12 }],
            5: [ { num1: 7, num2: 11 }, { num1: 9, num2: 12 }, { num1: 12, num2: 7 }, { num1: 11, num2: 11, story: "11 heroes have 11 gadgets." }, { num1: 8, num2: 9 }, { num1: 12, num2: 12 }, { num1: 6, num2: 8 }, { num1: 10, num2: 12 }, { num1: 4, num2: 11 }]
        };
        const promptTipsByLevel = {
            1: [ "Be clear! Tell Digit exactly what numbers to multiply.", "Try: 'Digit, what is 2 times 5?'", "Make sure to include both numbers!" ],
            2: [ "You can use words like 'calculate' or 'solve'.", "Example: 'Digit, please calculate 3 x 6.'", "Good prompts help Digit understand quickly!" ],
            3: [ "For story problems, find the two numbers.", "Example: 'If 7 dragons have 6 gems, solve 7 x 6.'", "Using 'power words' like 'Quickly solve' can be fun!" ],
            4: [ "The 11s and 12s tables are new! Focus on these.", "Try: 'Digit, super solve 11 times 4!'", "Clear instructions are key!" ],
            5: [ "You're a pro! Mix and match your prompt styles.", "Challenge Digit with any times table up to 12 x 12.", "Example: 'Digit, what is 12 multiplied by 9?'" ]
        };

        function setCharacterState(state, message = "") {
            character.textContent = characterEmojis[state] || characterEmojis.idle;
            character.className = 'character-image'; 
            if (Object.keys(characterEmojis).includes(state)) { // Ensure state is valid for animation
                character.classList.add(state);
            }
            speechBubble.textContent = message || getDefaultMessageForState(state);
        }

        function getDefaultMessageForState(state) {
             switch (state) {
                case 'thinking': return "Hmm, let me think...";
                case 'happy': return "You got it!";
                case 'confused': return "I'm a bit confused. Can you try rephrasing?";
                case 'correct': return "That's amazing!";
                case 'celebrate': return "Woohoo! That's awesome!";
                default: return "Hi! I'm Digit! Ready for a challenge?";
            }
        }

        function generateProblem() {
            const currentMaxLevel = Object.keys(problemsByLevel).length;
            if (level > currentMaxLevel) level = currentMaxLevel;

            const levelProblems = problemsByLevel[level] || problemsByLevel[1];
            const problemIndex = Math.floor(Math.random() * levelProblems.length);
            currentProblem = levelProblems[problemIndex];
            currentProblem.answer = currentProblem.num1 * currentProblem.num2;

            let problemText = `Challenge: What is ${currentProblem.num1} x ${currentProblem.num2}?`;
            if (currentProblem.story) {
                 problemText = `Challenge: ${currentProblem.story} (This means ${currentProblem.num1} x ${currentProblem.num2}!)`;
            }
            problemStatement.textContent = problemText;

            feedbackArea.textContent = "";
            promptInput.value = "";
            userAnswerInput.value = "";
            switchToPromptMode();
            setCharacterState('idle', `Okay, Level ${level}! ${currentProblem.story ? currentProblem.story : `What is ${currentProblem.num1} x ${currentProblem.num2}?`}`);
            updatePromptTips();
            checkAchievements(); // Check score/level based achievements at new problem
        }

        function updatePromptTips() {
            const currentMaxLevel = Object.keys(promptTipsByLevel).length;
            let tipsLevel = level > currentMaxLevel ? currentMaxLevel : level;
            const currentTips = promptTipsByLevel[tipsLevel] || promptTipsByLevel[1];
            tipsList.innerHTML = '';
            currentTips.forEach(tip => {
                const li = document.createElement('li');
                li.textContent = tip;
                tipsList.appendChild(li);
            });
        }

        function parsePrompt(promptText) {
            promptText = promptText.toLowerCase();
            const result = { numbers: [], intent: null, keywords: [], isClear: false };
            const numberMatches = promptText.match(/\d+/g);
            if (numberMatches) result.numbers = numberMatches.map(Number);

            if (promptText.includes('x') || promptText.includes('*') || promptText.includes('times') || promptText.includes('multiply') || promptText.includes('multiplied by')) {
                result.intent = 'multiply';
            }

            if (promptText.includes('quickly') || promptText.includes('fast')) result.keywords.push('quickly');
            if (promptText.includes('super') || promptText.includes('magic')) result.keywords.push('magic');
            if (promptText.includes('calculate') || promptText.includes('solve') || promptText.includes('what is')) result.keywords.push('solve_command');

            if (result.intent === 'multiply' && result.numbers.length >= 2) {
                if (currentProblem && typeof currentProblem.num1 !== 'undefined' && typeof currentProblem.num2 !== 'undefined') {
                    const problemNums = [currentProblem.num1, currentProblem.num2].sort();
                    const promptNumsSorted = result.numbers.slice(0,2).sort();
                    if (problemNums[0] === promptNumsSorted[0] && problemNums[1] === promptNumsSorted[1]) {
                         result.isClear = true;
                    }
                } else { console.error("currentProblem not defined in parsePrompt"); }
            }
            return result;
        }

        function switchToAnswerMode() {
            gameStage = 'answering';
            promptInput.style.display = 'none';
            userAnswerInput.style.display = 'block';
            userAnswerInput.focus();
            submitButton.textContent = 'Check My Answer!';
        }

        function switchToPromptMode() {
            gameStage = 'prompting';
            promptInput.style.display = 'block';
            userAnswerInput.style.display = 'none';
            promptInput.focus();
            submitButton.textContent = 'Send Prompt!';
        }

        function handleSubmitPrompt() {
            if (!currentProblem) { generateProblem(); return; }
            const userPromptText = promptInput.value.trim();
            if (!userPromptText) {
                feedbackArea.textContent = "Please type a prompt for Digit!";
                setCharacterState('confused', "You need to give me instructions!");
                return;
            }
            setCharacterState('thinking');
            feedbackArea.textContent = ""; 
            const parsed = parsePrompt(userPromptText);
            let promptFeedbackMessage = "";

            if (!parsed.isClear || parsed.intent !== 'multiply') {
                promptFeedbackMessage = "That prompt wasn't clear enough. ";
                if (parsed.intent === 'multiply' && parsed.numbers.length < 2) {
                    promptFeedbackMessage += `I need two numbers to multiply. Try 'solve ${currentProblem.num1} x ${currentProblem.num2}'.`;
                } else if (parsed.intent !== 'multiply') {
                    promptFeedbackMessage += `Are you asking me to multiply? Try using words like 'times' or 'x'.`;
                } else { 
                     promptFeedbackMessage += `Make sure you're asking about ${currentProblem.num1} and ${currentProblem.num2}. Example: 'Calculate ${currentProblem.num1} x ${currentProblem.num2}'.`;
                }
                setCharacterState('confused', promptFeedbackMessage);
                feedbackArea.textContent = promptFeedbackMessage;
                return;
            }

            successfulPrompts++;
            score += 5; // Base points for a good prompt
            if (parsed.keywords.length > 0) {
                score += 2; // Bonus for using "power words"
                promptFeedbackMessage = "Awesome prompt with power words! ";
            } else {
                promptFeedbackMessage = "Great prompt! Very clear. ";
            }
            
            updateScoreDisplay();
            feedbackArea.textContent = promptFeedbackMessage + "Now, what do YOU think the answer is?";
            setCharacterState('thinking', promptFeedbackMessage + `What do you think ${currentProblem.num1} x ${currentProblem.num2} is?`);
            switchToAnswerMode();
            checkAchievements(); // Check for prompt-based achievements
        }

        function handleCheckAnswer() {
            const userAnswerText = userAnswerInput.value.trim();
            if (userAnswerText === "") {
                feedbackArea.textContent = "Please type your answer!";
                setCharacterState('confused', "Don't forget to type your answer!");
                currentMathStreak = 0; // Reset streak
                updateStreakDisplay();
                return;
            }
            const userAnswer = parseInt(userAnswerText);

            if (isNaN(userAnswer)) {
                feedbackArea.textContent = "Please enter a number for your answer.";
                setCharacterState('confused', "That doesn't look like a number. Try again!");
                currentMathStreak = 0; // Reset streak
                updateStreakDisplay();
                return;
            }

            const correctAnswer = currentProblem.answer;
            let resultMessage = "";
            let isUserCorrect = userAnswer === correctAnswer;

            if (isUserCorrect) {
                correctMathAnswers++;
                currentMathStreak++;
                score += 10; // Points for correct math
                let streakBonus = 0;
                if (currentMathStreak >= 3) {
                    streakBonus = currentMathStreak * 2; // Example: 3 in a row = +6, 4 in a row = +8
                    score += streakBonus;
                }
                resultMessage = `Yes! ${currentProblem.num1} x ${currentProblem.num2} = ${correctAnswer}! `;
                if (streakBonus > 0) {
                    resultMessage += `Streak Bonus: +${streakBonus} points! `;
                }
                setCharacterState('correct', `Amazing! ${correctAnswer} is right! You earned points!`);
            } else {
                currentMathStreak = 0; // Reset streak
                resultMessage = `Almost! The correct answer to ${currentProblem.num1} x ${currentProblem.num2} is ${correctAnswer}. Your prompt was excellent, though! Keep practicing the tables!`;
                setCharacterState('happy', `Good try! The answer is ${correctAnswer}. Your prompt was great!`);
            }
            feedbackArea.textContent = resultMessage;
            updateScoreDisplay();
            updateStreakDisplay();
            checkTableMasterAchievements(isUserCorrect); // Check for table-specific achievements
            checkAchievements(); // Check general achievements

            const currentMaxLevel = Object.keys(problemsByLevel).length;
            const oldLevel = level;
            if (score >= level * 50 && level < currentMaxLevel) { // Level up condition based on score (e.g. L1->L2 at 50, L2->L3 at 100 etc)
                level++;
            } else if (score >= level * 50 + (level-currentMaxLevel)*50 && level === currentMaxLevel) { // Allow "virtual" leveling past max for continued scoring feel
                 // No actual level increase, but can add a message
            }


            if (level > oldLevel) {
                 setTimeout(() => { 
                    feedbackArea.textContent += ` 🎉 LEVEL UP! You reached Level ${level}! 🎉`;
                    setCharacterState('celebrate', `Woohoo! LEVEL ${level}! You're a Prompt Powerhouse!`);
                    updatePromptTips();
                    checkAchievements(); // Check for level up achievement
                }, 1500);
            } else if (level >= currentMaxLevel && score % 75 === 0 && score > (currentMaxLevel*50)) { // Special message for high scores at max level
                 setTimeout(() => {
                    feedbackArea.textContent += ` You're a Times Table Titan at Level ${level}! Score: ${score}!`;
                    setCharacterState('celebrate', `Awesome! You're mastering the game!`);
                }, 1500);
            }

            setTimeout(() => {
                generateProblem(); 
            }, 4500); 
        }

        submitButton.addEventListener('click', () => {
            if (gameStage === 'prompting') handleSubmitPrompt();
            else if (gameStage === 'answering') handleCheckAnswer();
        });
        promptInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && gameStage === 'prompting') handleSubmitPrompt(); });
        userAnswerInput.addEventListener('keypress', (e) => { if (e.key === 'Enter' && gameStage === 'answering') handleCheckAnswer(); });
        promptTipsButton.addEventListener('click', () => { tipsModal.style.display = 'flex'; });
        closeModalButton.addEventListener('click', () => { tipsModal.style.display = 'none'; });
        window.addEventListener('click', (e) => { if (e.target === tipsModal) tipsModal.style.display = 'none'; });

        // Initial setup
        generateProblem(); 
        updateScoreDisplay();
        updateStreakDisplay();
    </script>
</body>
</html>
�
